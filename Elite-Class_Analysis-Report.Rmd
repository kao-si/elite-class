---
title: "Preliminary Analysis Report"
output: 
    html_document:
        toc: true
        toc_float: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)

# Load packages
library(tidyverse)
library(knitr)
library(rddensity)
library(fixest)
library(rdrobust)
library(broom)
library(modelsummary)

# Source the data wrangling script
source("Elite-Class_04_Wrangle-Data.R")
```

# Descriptive Figures and Statistics

## Number of students in each cohort

```{r}
dat %>%
distinct(cohort, ssid) %>%
count(cohort) %>%
ggplot(aes(x = factor(cohort, levels = sort(unique(cohort),
decreasing = TRUE)), y = n)) +
  geom_col() +
  geom_text(aes(label = n), hjust = -0.3, size = 3) +
  coord_flip() +
  labs(title = "Number of Students in Each Cohort",
       x = "Cohort",
       y = "Number of Students")
```

## Number of elite vs. regular students in each cohort-track

```{r}
dat %>%
filter(elite %in% c("Elite Students", "Regular Students")) %>%
distinct(policy, cohort, track, elite, ssid) %>%
count(policy, cohort, track, elite) %>%
ggplot(aes(x = factor(cohort, levels = sort(unique(cohort),
decreasing = TRUE)), y = n, fill = elite)) +
  geom_col(position = "dodge") +
  geom_text(aes(label = n), position = position_dodge(width = 0.9),
  hjust = -0.3, size = 3) +
  coord_flip() +
  facet_grid(policy ~ track, scales = "free_y", space = "free_y") +
  labs(
    title = "Number of Students in Each Category of `elite` in
    Each Cohort-Track",
    x = "Cohort",
    y = "Number of Students"
  ) +
  theme(legend.position = "top", legend.title = element_blank())
```

**Including all categories of students**

```{r}
dat %>%
distinct(policy, cohort, track, elite, ssid) %>%
count(policy, cohort, track, elite) %>%
ggplot(aes(x = factor(cohort, levels = sort(unique(cohort),
decreasing = TRUE)), y = n, fill = elite)) +
  geom_col(position = "dodge") +
  geom_text(aes(label = n), position = position_dodge(width = 0.9),
  hjust = -0.3, size = 3) +
  coord_flip() +
  facet_grid(policy ~ track, scales = "free_y", space = "free_y") +
  labs(
    title = "Number of Students in Each Category of `elite` in
    Each Cohort-Track",
    x = "Cohort",
    y = "Number of Students"
  ) +
  theme(legend.position = "top", legend.title = element_blank())
```

## Elite students and top regular students by decile of HSEE total score

```{r}
gg_decile <- function(cohort_val) {
    dat %>%
      filter(!is.na(top_cat), exam == "hsee", cohort == cohort_val) %>%
      # Compute counts and groupwise max(tot) per decile within each facet group (track × top_cat)
      group_by(track, top_cat, hsee_decile) %>%
      mutate(
        n_dec = n(),
        y_pos = max(tot, na.rm = TRUE)
      ) %>%
      ungroup() %>%
      ggplot(aes(
        x = factor(hsee_decile),
        y = tot,
        color = factor(hsee_decile)
      )) +
        geom_point(size = 1, alpha = 0.5,
          position = position_jitter(width = 0.2, height = 0)) +
        # Add count labels (one per decile per facet)
        geom_text(
          aes(
            x = factor(hsee_decile),
            y = y_pos,
            label = n_dec
          ),
          vjust = -2,
          size = 3,
          color = "black"
        ) +
        facet_grid(track ~ factor(top_cat, levels = c("Top Regular Students","Elite Students"))) +
        guides(color = "none") +
        labs(
          title = paste0("HSEE Total Scores by Decile in Cohort ", cohort_val),
          x = "Decile of HSEE Total Score",
          y = "HSEE Total Score"
        )
}

# Print all plots
walk(unique(dat$cohort), ~ print(gg_decile(.)))
```

## Distribution of students by demographic characteristics in each cohort-track

```{r}
demo_col <- c("male", "rural", "onlychd", "board", "jhsch_rural", "han",
"polsta", "spec2", "f_job", "f_edu", "f_polsta", "m_job", "m_edu", "m_polsta")

gg_demo <- function(var) {
    dat %>%
      distinct(cohort, track, !!rlang::sym(var), ssid) %>%
      count(cohort, track, !!rlang::sym(var)) %>%
      ggplot(aes(x = factor(cohort, levels = sort(unique(cohort),
      decreasing = TRUE)), y = n, fill = !!rlang::sym(var))) +
        geom_col(position = "dodge") +
        geom_text(aes(label = n), position = position_dodge(width = 0.9),
        hjust = -0.3, size = 3) +
        coord_flip() +
        facet_wrap(~ track) +
        labs(
          title = paste0("Number of Students in Each Category of **", var,
          "** in Each Cohort-Track"),
          x = "Cohort",
          y = "Number of Students"
        ) +
        theme(
            legend.position = "top",
            legend.title = element_blank(),
            plot.title = ggtext::element_markdown()
        )
}

# Print all plots
walk(demo_col, ~ print(gg_demo(.)))
```

## Exam score availability in each cohort-track

```{r}
gg_score <- function(var) {
    dat %>%
      select(cohort, track, exam, !!rlang::sym(var)) %>%
      group_by(cohort, track, exam) %>%
      summarize(n = sum(!is.na(!!rlang::sym(var)))) %>%
      ggplot(aes(x = exam, y = n, color = cohort)) +
        geom_jitter(position = position_jitter(width = 0.15)) +
        ggrepel::geom_text_repel(aes(label = cohort),
        show.legend = FALSE, size = 3) +
        facet_wrap(~ track, ncol = 1, scales = "free_y") +
        labs(
          title = paste0("Number of Available Scores for **", var,
          "** in Each Cohort-Track"),
          x = "Exam",
          y = "Number of Available Scores"
        ) +
        theme(plot.title = ggtext::element_markdown())
}

# Print all plots
walk(zscore_col, ~ print(gg_score(.)))
```

# Regression Discontinuity: Assumption Checks

## Graphic evidence of a sharp regression discontinuity design

```{r}
dat %>%
  filter(policy == "Treated",
  elite %in% c("Elite Students", "Regular Students")) %>%
  distinct(cssid, .keep_all = TRUE) %>%
  ggplot(aes(x = hsee_ctot, y = elite, color = elite)) +
    geom_point(size = 0.5, alpha = 0.5,
      position = position_jitter(height = 0.3)) +
    geom_vline(xintercept = 0) +
    labs(
      title = "Evidence of a Sharp Regression Discontinuity Design",
      x = "Total Score in HSEE Centered around the Cutoffs",
      y = "Student Category"
    ) +
    guides(color = "none")
```

**Including all categories of students**

```{r}
dat %>%
  filter(policy == "Treated") %>%
  distinct(cssid, .keep_all = TRUE) %>%
  ggplot(aes(x = hsee_ctot, y = elite, color = elite)) +
    geom_point(size = 0.5, alpha = 0.5,
      position = position_jitter(height = 0.2)) +
    geom_vline(xintercept = 0) +
    labs(
      title = "Evidence of a Sharp Regression Discontinuity Design",
      x = "Total Score in HSEE Centered around the Cutoffs",
      y = "Student Category"
    ) +
    guides(color = "none")
```

## Check for continuity assumption in each cohort-track

### Histograms

```{r}
dat %>%
  filter(policy == "Treated",
  elite %in% c("Elite Students", "Regular Students")) %>%
  distinct(cssid, .keep_all = TRUE) %>%
  ggplot(aes(x = hsee_ctot, fill = elite)) +
    geom_histogram(binwidth = 0.05) +
    geom_vline(xintercept = 0) +
    facet_grid(cohort ~ track) +
    labs(
      title = "Check for Continuity Assumption",
      x = "Standardized HSEE Total Score Centered around the Cutoffs",
      fill = "Student Category"
    )
```

### McCrary density tests

```{r}
cohort_col <- c("2003", "2004", "2005", "2005", "2006", "2006", "2007", "2007")
track_col <- c("Science Track", "Science Track",
rep(c("Liberal Arts Track", "Science Track"), times = 3))

density_test <- function(cohort_val, track_val) {
    run_var <- dat %>%
      filter(elite %in% c("Elite Students", "Regular Students"),
      cohort == cohort_val, track == track_val) %>%
      distinct(cssid, .keep_all = TRUE) %>%
      pull(hsee_ctot)

    density_test <- rddensity(run_var, c = 0)

    cat("Cohort:", cohort_val, "Track:", track_val, "\n")
    print(summary(density_test))
    cat("\n")
    plot_test <- rdplotdensity(rdd = density_test,
                               X = run_var,
                               type = "both")
    cat("\n")
}

walk2(cohort_col, track_col, density_test)
```

# Regression Discontinuity: Models and Results

## Benchmark models

**Non-parametric models using `rdrobust`**

**Report and interpret the coefficient estimates under the method "Robust"**

> Footnote: All RD estimates are obtained using the robust bias-corrected procedure implemented in rdrobust (Calonico, Cattaneo, and Titiunik 2014, 2015; Calonico et al. 2019). We report the robust (bias-corrected) point estimates and standard errors as our main results, since they deliver valid inference under MSE-optimal bandwidth selection. Conventional estimates are shown only for comparison.

**Include cohort covariates**

```{r}
# Prepare `cohort` as a dummy control for `rdrobust`

# Factor `cohort` to make it categorical
cohort_factor <- factor(wdat_rd$cohort, levels = 2003:2007)

# Create a numeric matrix with K-1 dummies and remove the intercept
# Use drop = FALSE to guarantee a matrix output
cov_cohort <- model.matrix(~ cohort_factor)[, -1, drop = FALSE]
```

```{r}
# Non-parametric models with `rdrobust`
# Including cohort covariates

# Science Track, CEE
bm_s1 <- rdrobust(
  y = wdat_rd$cee_ztot_trim,
  x = wdat_rd$hsee_ctot,
  covs = cov_cohort,
  c = 0,
  subset = (wdat_rd$track == "Science Track") &
  # ensure that the analysis only includes complete cases
  complete.cases(wdat_rd$cee_ztot_trim, wdat_rd$hsee_ctot, cov_cohort)
)

# Science Track, Average High School Performance
bm_s2 <- rdrobust(
  y = wdat_rd$avg_hs,
  x = wdat_rd$hsee_ctot,
  covs = cov_cohort,
  c = 0,
  subset = (wdat_rd$track == "Science Track") &
           complete.cases(wdat_rd$avg_hs, wdat_rd$hsee_ctot, cov_cohort)
)

# Liberal Arts Track, CEE
bm_l1 <- rdrobust(
  y = wdat_rd$cee_ztot_trim,
  x = wdat_rd$hsee_ctot,
  covs = cov_cohort,
  c = 0,
  subset = (wdat_rd$track == "Liberal Arts Track") &
           complete.cases(wdat_rd$cee_ztot_trim, wdat_rd$hsee_ctot, cov_cohort)
)

# Liberal Arts Track, Average High School Performance
bm_l2 <- rdrobust(
  y = wdat_rd$avg_hs,
  x = wdat_rd$hsee_ctot,
  covs = cov_cohort,
  c = 0,
  subset = (wdat_rd$track == "Liberal Arts Track") &
           complete.cases(wdat_rd$avg_hs, wdat_rd$hsee_ctot, cov_cohort)
)

bm_panels <- list(
  "Science Track" = list(
    "CEE Total Score"                 = bm_s1,
    "Average High School Performance" = bm_s2
  ),
  "Liberal Arts Track" = list(
    "CEE Total Score"                 = bm_l1,
    "Average High School Performance" = bm_l2
  )
)

modelsummary(
  bm_panels,
  shape     = "cbind",
  statistic = "std.error",
  coef_map  = c(
    "Conventional" = "Conventional",
    "Robust"       = "Robust"
  ),
  gof_omit  = "^R2 Within|AIC|BIC",
  stars     = TRUE,
  title     = "Benchmark Non-parametric Models",
  output    = "markdown"
)
```

**Refit benchmark models without cohort covariates**

```{r}
# Science Track, CEE
bm_s1_nocov <- rdrobust(
  y = wdat_rd$cee_ztot_trim,
  x = wdat_rd$hsee_ctot,
  c = 0,
  subset = (wdat_rd$track == "Science Track") &
           complete.cases(wdat_rd$cee_ztot_trim, wdat_rd$hsee_ctot)
)

# Science Track, Average High School Performance
bm_s2_nocov <- rdrobust(
  y = wdat_rd$avg_hs,
  x = wdat_rd$hsee_ctot,
  c = 0,
  subset = (wdat_rd$track == "Science Track") &
           complete.cases(wdat_rd$avg_hs, wdat_rd$hsee_ctot)
)

# Liberal Arts Track, CEE
bm_l1_nocov <- rdrobust(
  y = wdat_rd$cee_ztot_trim,
  x = wdat_rd$hsee_ctot,
  c = 0,
  subset = (wdat_rd$track == "Liberal Arts Track") &
           complete.cases(wdat_rd$cee_ztot_trim, wdat_rd$hsee_ctot)
)

# Liberal Arts Track, Average High School Performance
bm_l2_nocov <- rdrobust(
  y = wdat_rd$avg_hs,
  x = wdat_rd$hsee_ctot,
  c = 0,
  subset = (wdat_rd$track == "Liberal Arts Track") &
           complete.cases(wdat_rd$avg_hs, wdat_rd$hsee_ctot)
)

bm_panels_nocov <- list(
  "Science Track" = list(
    "CEE Total Score"                 = bm_s1_nocov,
    "Average High School Performance" = bm_s2_nocov
  ),
  "Liberal Arts Track" = list(
    "CEE Total Score"                 = bm_l1_nocov,
    "Average High School Performance" = bm_l2_nocov
  )
)

modelsummary(
  bm_panels_nocov,
  shape     = "cbind",
  statistic = "std.error",
  coef_map  = c(
    "Conventional" = "Conventional",
    "Robust"       = "Robust"
  ),
  gof_omit  = "^R2 Within|AIC|BIC",
  stars     = TRUE,
  title     = "Benchmark Non-parametric Models Without Covariates",
  output    = "markdown"
)
```

### Graphic evidence using `rdplot`

**Plots unadjusted for covariates**

```{r}
# Plots unadjusted for covariates
# (rdplot() always shows binned means of the raw outcome (unadjusted dots))
# (when passing covs, rdplot() overlays a covariate-adjusted fit)
# (the adjusted curve could be visually incompatible with the local binned means)

# Science Track, CEE
rdplot(
  y = wdat_rd$cee_ztot_trim,
  x = wdat_rd$hsee_ctot,
  c = 0,
  subset = (wdat_rd$track == "Science Track") &
  complete.cases(wdat_rd$cee_ztot_trim, wdat_rd$hsee_ctot),
  kernel = "triangular",
  # use the bandwidth from the benchmark model
  h = bm_s1$bws[1, ],
  x.lim = c(-bm_s1$bws[1, 1], bm_s1$bws[1, 2]),
  y.lim = c(0, 2),
  title = "Non-parametric Estimation of the Effect of HSEE on CEE Scores: Science Track",
  x.label = "Standardized HSEE Total Score Centered around the Cutoffs",
  y.label = "Standardized CEE Total Score"
)

# Science Track, Average High School Performance
rdplot(
  y = wdat_rd$avg_hs,
  x = wdat_rd$hsee_ctot,
  c = 0,
  subset = (wdat_rd$track == "Science Track") &
           complete.cases(wdat_rd$avg_hs, wdat_rd$hsee_ctot),
  kernel = "triangular",
  # use the bandwidth from the benchmark model
  h = bm_s2$bws[1, ],
  x.lim = c(-bm_s2$bws[1, 1], bm_s2$bws[1, 2]),
  y.lim = c(0, 2),
  title = "Non-parametric Estimation of the Effect of HSEE on Average High School Performance: Science Track",
  x.label = "Standardized HSEE Total Score Centered around the Cutoffs",
  y.label = "Average High School Performance"
)

# Liberal Arts Track, CEE
rdplot(
  y = wdat_rd$cee_ztot_trim,
  x = wdat_rd$hsee_ctot,
  c = 0,
  subset = (wdat_rd$track == "Liberal Arts Track") &
           complete.cases(wdat_rd$cee_ztot_trim, wdat_rd$hsee_ctot),
  kernel = "triangular",
  # use the bandwidth from the benchmark model
  h = bm_l1$bws[1, ],
  x.lim = c(-bm_l1$bws[1, 1], bm_l1$bws[1, 2]),
  y.lim = c(0, 2),
  title = "Non-parametric Estimation of the Effect of HSEE on CEE Scores: Liberal Arts Track",
  x.label = "Standardized HSEE Total Score Centered around the Cutoffs",
  y.label = "Standardized CEE Total Score"
)

# Liberal Arts Track, Average High School Performance
rdplot(
  y = wdat_rd$avg_hs,
  x = wdat_rd$hsee_ctot,
  c = 0,
  subset = (wdat_rd$track == "Liberal Arts Track") &
           complete.cases(wdat_rd$avg_hs, wdat_rd$hsee_ctot),
  kernel = "triangular",
  # use the bandwidth from the benchmark model
  h = bm_l2$bws[1, ],
  x.lim = c(-bm_l2$bws[1, 1], bm_l2$bws[1, 2]),
  y.lim = c(0, 2),
  title = "Non-parametric Estimation of the Effect of HSEE on Average High School Performance: Liberal Arts Track",
  x.label = "Standardized HSEE Total Score Centered around the Cutoffs",
  y.label = "Average High School Performance"
)
```

## Gender gap

### Science track

```{r}
# Non-parametric models with `rdrobust`
# Including cohort covariates

# CEE
male_s1 <- rdrobust(
  y = wdat_rd$cee_ztot_trim,
  x = wdat_rd$hsee_ctot,
  covs = cov_cohort,
  c = 0,
  subset = (wdat_rd$track == "Science Track" & wdat_rd$male == "Yes") &
           complete.cases(wdat_rd$cee_ztot_trim, wdat_rd$hsee_ctot, cov_cohort)
)

female_s1 <- rdrobust(
  y = wdat_rd$cee_ztot_trim,
  x = wdat_rd$hsee_ctot,
  covs = cov_cohort,
  c = 0,
  subset = (wdat_rd$track == "Science Track" & wdat_rd$male == "No") &
           complete.cases(wdat_rd$cee_ztot_trim, wdat_rd$hsee_ctot, cov_cohort)
)

# Average High School Performance
male_s2 <- rdrobust(
  y = wdat_rd$avg_hs,
  x = wdat_rd$hsee_ctot,
  covs = cov_cohort,
  c = 0,
  subset = (wdat_rd$track == "Science Track" & wdat_rd$male == "Yes") &
           complete.cases(wdat_rd$avg_hs, wdat_rd$hsee_ctot, cov_cohort)
)

female_s2 <- rdrobust(
  y = wdat_rd$avg_hs,
  x = wdat_rd$hsee_ctot,
  covs = cov_cohort,
  c = 0,
  subset = (wdat_rd$track == "Science Track" & wdat_rd$male == "No") &
           complete.cases(wdat_rd$avg_hs, wdat_rd$hsee_ctot, cov_cohort)
)

gender_panels_s <- list(
  "CEE Total Score" = list(
    "Male"   = male_s1,
    "Female" = female_s1
  ),
  "Average High School Performance" = list(
    "Male"   = male_s2,
    "Female" = female_s2
  )
)

modelsummary(
  gender_panels_s,
  shape     = "cbind",
  statistic = "std.error",
  coef_map  = c(
    "Conventional" = "Conventional",
    "Robust"       = "Robust"
  ),
  gof_omit  = "^R2 Within|AIC|BIC",
  stars     = TRUE,
  title     = "Gender Differences: Science Track (Non-parametric Models)",
  output    = "markdown"
)
```

Andreu Arenas, Caterina Calsamiglia (2025) Gender Differences in High-Stakes Performance and College Admission Policies. Management Science 71(10):8413-8429.

Ghazala Azmat, Caterina Calsamiglia, Nagore Iriberri, Gender Differences in Response to Big Stakes, Journal of the European Economic Association, Volume 14, Issue 6, 1 December 2016, Pages 1372–1400.

Shurchkov, O. (2012). UNDER PRESSURE: GENDER DIFFERENCES IN OUTPUT QUALITY AND QUANTITY UNDER COMPETITION AND TIME CONSTRAINTS. Journal of the European Economic Association, 10(5), 1189–1213.

Analia Schlosser, Zvika Neeman, Yigal Attali, Differential Performance in High Versus Low Stakes Tests: Evidence from the Gre Test*, The Economic Journal, Volume 129, Issue 623, October 2019, Pages 2916–2948.

### Liberal arts track

```{r}
# Non-parametric models with `rdrobust`
# Including cohort covariates

# CEE
male_l1 <- rdrobust(
  y = wdat_rd$cee_ztot_trim,
  x = wdat_rd$hsee_ctot,
  covs = cov_cohort,
  c = 0,
  subset = (wdat_rd$track == "Liberal Arts Track" & wdat_rd$male == "Yes") &
           complete.cases(wdat_rd$cee_ztot_trim, wdat_rd$hsee_ctot, cov_cohort)
)

female_l1 <- rdrobust(
  y = wdat_rd$cee_ztot_trim,
  x = wdat_rd$hsee_ctot,
  covs = cov_cohort,
  c = 0,
  subset = (wdat_rd$track == "Liberal Arts Track" & wdat_rd$male == "No") &
           complete.cases(wdat_rd$cee_ztot_trim, wdat_rd$hsee_ctot, cov_cohort)
)

# Average High School Performance
male_l2 <- rdrobust(
  y = wdat_rd$avg_hs,
  x = wdat_rd$hsee_ctot,
  covs = cov_cohort,
  c = 0,
  subset = (wdat_rd$track == "Liberal Arts Track" & wdat_rd$male == "Yes") &
           complete.cases(wdat_rd$avg_hs, wdat_rd$hsee_ctot, cov_cohort)
)

female_l2 <- rdrobust(
  y = wdat_rd$avg_hs,
  x = wdat_rd$hsee_ctot,
  covs = cov_cohort,
  c = 0,
  subset = (wdat_rd$track == "Liberal Arts Track" & wdat_rd$male == "No") &
           complete.cases(wdat_rd$avg_hs, wdat_rd$hsee_ctot, cov_cohort)
)

gender_panels_l <- list(
  "CEE Total Score" = list(
    "Male"   = male_l1,
    "Female" = female_l1
  ),
  "Average High School Performance" = list(
    "Male"   = male_l2,
    "Female" = female_l2
  )
)

modelsummary(
  gender_panels_l,
  shape     = "cbind",
  statistic = "std.error",
  coef_map  = c(
    "Conventional" = "Conventional",
    "Robust"       = "Robust"
  ),
  gof_omit  = "^R2 Within|AIC|BIC",
  stars     = TRUE,
  title     = "Gender Differences: Liberal Arts Track (Non-parametric Models)",
  output    = "markdown"
)
```

## Rural vs. urban

### Science track

```{r}
# Non-parametric models with `rdrobust`
# Including cohort covariates

# CEE
rural_s1 <- rdrobust(
  y = wdat_rd$cee_ztot_trim,
  x = wdat_rd$hsee_ctot,
  covs = cov_cohort,
  c = 0,
  subset = (wdat_rd$track == "Science Track" & wdat_rd$rural == "Yes") &
           complete.cases(wdat_rd$cee_ztot_trim, wdat_rd$hsee_ctot, cov_cohort)
)

urban_s1 <- rdrobust(
  y = wdat_rd$cee_ztot_trim,
  x = wdat_rd$hsee_ctot,
  covs = cov_cohort,
  c = 0,
  subset = (wdat_rd$track == "Science Track" & wdat_rd$rural == "No") &
           complete.cases(wdat_rd$cee_ztot_trim, wdat_rd$hsee_ctot, cov_cohort)
)

# Average High School Performance
rural_s2 <- rdrobust(
  y = wdat_rd$avg_hs,
  x = wdat_rd$hsee_ctot,
  covs = cov_cohort,
  c = 0,
  subset = (wdat_rd$track == "Science Track" & wdat_rd$rural == "Yes") &
           complete.cases(wdat_rd$avg_hs, wdat_rd$hsee_ctot, cov_cohort)
)

urban_s2 <- rdrobust(
  y = wdat_rd$avg_hs,
  x = wdat_rd$hsee_ctot,
  covs = cov_cohort,
  c = 0,
  subset = (wdat_rd$track == "Science Track" & wdat_rd$rural == "No") &
           complete.cases(wdat_rd$avg_hs, wdat_rd$hsee_ctot, cov_cohort)
)

rural_panels_s <- list(
  "CEE Total Score" = list(
    "Rural" = rural_s1,
    "Urban" = urban_s1
  ),
  "Average High School Performance" = list(
    "Rural" = rural_s2,
    "Urban" = urban_s2
  )
)

modelsummary(
  rural_panels_s,
  shape     = "cbind",
  statistic = "std.error",
  coef_map  = c(
    "Conventional" = "Conventional",
    "Robust"       = "Robust"
  ),
  gof_omit  = "^R2 Within|AIC|BIC",
  stars     = TRUE,
  title     = "Rural vs Urban: Science Track (Non-parametric Models)",
  output    = "markdown"
)
```

### Liberal arts track

```{r}
# Non-parametric models with `rdrobust`
# Including cohort covariates

# CEE
rural_l1 <- rdrobust(
  y = wdat_rd$cee_ztot_trim,
  x = wdat_rd$hsee_ctot,
  covs = cov_cohort,
  c = 0,
  subset = (wdat_rd$track == "Liberal Arts Track" & wdat_rd$rural == "Yes") &
           complete.cases(wdat_rd$cee_ztot_trim, wdat_rd$hsee_ctot, cov_cohort)
)

urban_l1 <- rdrobust(
  y = wdat_rd$cee_ztot_trim,
  x = wdat_rd$hsee_ctot,
  covs = cov_cohort,
  c = 0,
  subset = (wdat_rd$track == "Liberal Arts Track" & wdat_rd$rural == "No") &
           complete.cases(wdat_rd$cee_ztot_trim, wdat_rd$hsee_ctot, cov_cohort)
)

# Average High School Performance
rural_l2 <- rdrobust(
  y = wdat_rd$avg_hs,
  x = wdat_rd$hsee_ctot,
  covs = cov_cohort,
  c = 0,
  subset = (wdat_rd$track == "Liberal Arts Track" & wdat_rd$rural == "Yes") &
           complete.cases(wdat_rd$avg_hs, wdat_rd$hsee_ctot, cov_cohort)
)

urban_l2 <- rdrobust(
  y = wdat_rd$avg_hs,
  x = wdat_rd$hsee_ctot,
  covs = cov_cohort,
  c = 0,
  subset = (wdat_rd$track == "Liberal Arts Track" & wdat_rd$rural == "No") &
           complete.cases(wdat_rd$avg_hs, wdat_rd$hsee_ctot, cov_cohort)
)

rural_panels_l <- list(
  "CEE Total Score" = list(
    "Rural" = rural_l1,
    "Urban" = urban_l1
  ),
  "Average High School Performance" = list(
    "Rural" = rural_l2,
    "Urban" = urban_l2
  )
)

modelsummary(
  rural_panels_l,
  shape     = "cbind",
  statistic = "std.error",
  coef_map  = c(
    "Conventional" = "Conventional",
    "Robust"       = "Robust"
  ),
  gof_omit  = "^R2 Within|AIC|BIC",
  stars     = TRUE,
  title     = "Rural vs Urban: Liberal Arts Track (Non-parametric Models)",
  output    = "markdown"
)
```

## Rural vs. urban (using `jhsch_rural`)

### Science track

```{r}
# Non-parametric models with `rdrobust`
# Including cohort covariates

# CEE
jhschrural_s1 <- rdrobust(
  y = wdat_rd$cee_ztot_trim,
  x = wdat_rd$hsee_ctot,
  covs = cov_cohort,
  c = 0,
  subset = (wdat_rd$track == "Science Track" & wdat_rd$jhsch_rural == "Yes") &
           complete.cases(wdat_rd$cee_ztot_trim, wdat_rd$hsee_ctot, cov_cohort)
)

jhschurban_s1 <- rdrobust(
  y = wdat_rd$cee_ztot_trim,
  x = wdat_rd$hsee_ctot,
  covs = cov_cohort,
  c = 0,
  subset = (wdat_rd$track == "Science Track" & wdat_rd$jhsch_rural == "No") &
           complete.cases(wdat_rd$cee_ztot_trim, wdat_rd$hsee_ctot, cov_cohort)
)

# Average High School Performance
jhschrural_s2 <- rdrobust(
  y = wdat_rd$avg_hs,
  x = wdat_rd$hsee_ctot,
  covs = cov_cohort,
  c = 0,
  subset = (wdat_rd$track == "Science Track" & wdat_rd$jhsch_rural == "Yes") &
           complete.cases(wdat_rd$avg_hs, wdat_rd$hsee_ctot, cov_cohort)
)

jhschurban_s2 <- rdrobust(
  y = wdat_rd$avg_hs,
  x = wdat_rd$hsee_ctot,
  covs = cov_cohort,
  c = 0,
  subset = (wdat_rd$track == "Science Track" & wdat_rd$jhsch_rural == "No") &
           complete.cases(wdat_rd$avg_hs, wdat_rd$hsee_ctot, cov_cohort)
)

jhschrural_panels_s <- list(
  "CEE Total Score" = list(
    "Rural" = jhschrural_s1,
    "Urban" = jhschurban_s1
  ),
  "Average High School Performance" = list(
    "Rural" = jhschrural_s2,
    "Urban" = jhschurban_s2
  )
)

modelsummary(
  jhschrural_panels_s,
  shape     = "cbind",
  statistic = "std.error",
  coef_map  = c(
    "Conventional" = "Conventional",
    "Robust"       = "Robust"
  ),
  gof_omit  = "^R2 Within|AIC|BIC",
  stars     = TRUE,
  title     = "Rural vs Urban Junior High School: Science Track (Non-parametric Models)",
  output    = "markdown"
)
```

### Liberal arts track

```{r}
# Non-parametric models with `rdrobust`
# Including cohort covariates

# CEE
jhschrural_l1 <- rdrobust(
  y = wdat_rd$cee_ztot_trim,
  x = wdat_rd$hsee_ctot,
  covs = cov_cohort,
  c = 0,
  subset = (wdat_rd$track == "Liberal Arts Track" & wdat_rd$jhsch_rural == "Yes") &
           complete.cases(wdat_rd$cee_ztot_trim, wdat_rd$hsee_ctot, cov_cohort)
)

jhschurban_l1 <- rdrobust(
  y = wdat_rd$cee_ztot_trim,
  x = wdat_rd$hsee_ctot,
  covs = cov_cohort,
  c = 0,
  subset = (wdat_rd$track == "Liberal Arts Track" & wdat_rd$jhsch_rural == "No") &
           complete.cases(wdat_rd$cee_ztot_trim, wdat_rd$hsee_ctot, cov_cohort)
)

# Average High School Performance
jhschrural_l2 <- rdrobust(
  y = wdat_rd$avg_hs,
  x = wdat_rd$hsee_ctot,
  covs = cov_cohort,
  c = 0,
  subset = (wdat_rd$track == "Liberal Arts Track" & wdat_rd$jhsch_rural == "Yes") &
           complete.cases(wdat_rd$avg_hs, wdat_rd$hsee_ctot, cov_cohort)
)

jhschurban_l2 <- rdrobust(
  y = wdat_rd$avg_hs,
  x = wdat_rd$hsee_ctot,
  covs = cov_cohort,
  c = 0,
  subset = (wdat_rd$track == "Liberal Arts Track" & wdat_rd$jhsch_rural == "No") &
           complete.cases(wdat_rd$avg_hs, wdat_rd$hsee_ctot, cov_cohort)
)

jhschrural_panels_l <- list(
  "CEE Total Score" = list(
    "Rural" = jhschrural_l1,
    "Urban" = jhschurban_l1
  ),
  "Average High School Performance" = list(
    "Rural" = jhschrural_l2,
    "Urban" = jhschurban_l2
  )
)

modelsummary(
  jhschrural_panels_l,
  shape     = "cbind",
  statistic = "std.error",
  coef_map  = c(
    "Conventional" = "Conventional",
    "Robust"       = "Robust"
  ),
  gof_omit  = "^R2 Within|AIC|BIC",
  stars     = TRUE,
  title     = "Rural vs Urban Junior High School: Liberal Arts Track (Non-parametric Models)",
  output    = "markdown"
)
```

## Father's employment status

### Distribution of father's employment status

```{r}
datasummary_crosstab(
  track ~ f_job,
  data = wdat_rd %>% dplyr::mutate(f_job = forcats::fct_na_value_to_level(f_job, level = "Missing")),
  title = "Distribution of Father's Employment Status",
  output = "markdown"
)

datasummary_crosstab(
  track ~ f_job_l2,
  data = wdat_rd %>% dplyr::mutate(f_job_l2 = forcats::fct_na_value_to_level(f_job_l2, level = "Missing")),
  title = "Distribution of Father's Employment Status (2 Levels)",
  output = "markdown"
)
```

### Science track

```{r}
# Non-parametric models with `rdrobust`
# Including cohort covariates

# CEE
fjob_low_s1 <- rdrobust(
  y = wdat_rd$cee_ztot_trim,
  x = wdat_rd$hsee_ctot,
  covs = cov_cohort,
  c = 0,
  subset = (wdat_rd$track == "Science Track" & wdat_rd$f_job_l2 == "Low Status Jobs") &
           complete.cases(wdat_rd$cee_ztot_trim, wdat_rd$hsee_ctot, cov_cohort)
)

fjob_high_s1 <- rdrobust(
  y = wdat_rd$cee_ztot_trim,
  x = wdat_rd$hsee_ctot,
  covs = cov_cohort,
  c = 0,
  subset = (wdat_rd$track == "Science Track" & wdat_rd$f_job_l2 == "High Status Jobs") &
           complete.cases(wdat_rd$cee_ztot_trim, wdat_rd$hsee_ctot, cov_cohort)
)

# Average High School Performance
fjob_low_s2 <- rdrobust(
  y = wdat_rd$avg_hs,
  x = wdat_rd$hsee_ctot,
  covs = cov_cohort,
  c = 0,
  subset = (wdat_rd$track == "Science Track" & wdat_rd$f_job_l2 == "Low Status Jobs") &
           complete.cases(wdat_rd$avg_hs, wdat_rd$hsee_ctot, cov_cohort)
)

fjob_high_s2 <- rdrobust(
  y = wdat_rd$avg_hs,
  x = wdat_rd$hsee_ctot,
  covs = cov_cohort,
  c = 0,
  subset = (wdat_rd$track == "Science Track" & wdat_rd$f_job_l2 == "High Status Jobs") &
           complete.cases(wdat_rd$avg_hs, wdat_rd$hsee_ctot, cov_cohort)
)

fjob_panels_s <- list(
  "CEE Total Score" = list(
    "Low Status Jobs"  = fjob_low_s1,
    "High Status Jobs" = fjob_high_s1
  ),
  "Average High School Performance" = list(
    "Low Status Jobs"  = fjob_low_s2,
    "High Status Jobs" = fjob_high_s2
  )
)

modelsummary(
  fjob_panels_s,
  shape     = "cbind",
  statistic = "std.error",
  coef_map  = c("Conventional" = "Conventional", "Robust" = "Robust"),
  gof_omit  = "^R2 Within|AIC|BIC",
  stars     = TRUE,
  title     = "Split by Father's Employment Status: Science Track (Non-parametric Models)",
  output    = "markdown"
)
```

### Liberal arts track

```{r}
# Non-parametric models with `rdrobust`
# Including cohort covariates

# CEE
fjob_low_l1 <- rdrobust(
  y = wdat_rd$cee_ztot_trim,
  x = wdat_rd$hsee_ctot,
  covs = cov_cohort,
  c = 0,
  subset = (wdat_rd$track == "Liberal Arts Track" & wdat_rd$f_job_l2 == "Low Status Jobs") &
           complete.cases(wdat_rd$cee_ztot_trim, wdat_rd$hsee_ctot, cov_cohort)
)

fjob_high_l1 <- rdrobust(
  y = wdat_rd$cee_ztot_trim,
  x = wdat_rd$hsee_ctot,
  covs = cov_cohort,
  c = 0,
  subset = (wdat_rd$track == "Liberal Arts Track" & wdat_rd$f_job_l2 == "High Status Jobs") &
           complete.cases(wdat_rd$cee_ztot_trim, wdat_rd$hsee_ctot, cov_cohort)
)

# Average High School Performance
fjob_low_l2 <- rdrobust(
  y = wdat_rd$avg_hs,
  x = wdat_rd$hsee_ctot,
  covs = cov_cohort,
  c = 0,
  subset = (wdat_rd$track == "Liberal Arts Track" & wdat_rd$f_job_l2 == "Low Status Jobs") &
           complete.cases(wdat_rd$avg_hs, wdat_rd$hsee_ctot, cov_cohort)
)

fjob_high_l2 <- rdrobust(
  y = wdat_rd$avg_hs,
  x = wdat_rd$hsee_ctot,
  covs = cov_cohort,
  c = 0,
  subset = (wdat_rd$track == "Liberal Arts Track" & wdat_rd$f_job_l2 == "High Status Jobs") &
           complete.cases(wdat_rd$avg_hs, wdat_rd$hsee_ctot, cov_cohort)
)

fjob_panels_l <- list(
  "CEE Total Score" = list(
    "Low Status Jobs"  = fjob_low_l1,
    "High Status Jobs" = fjob_high_l1
  ),
  "Average High School Performance" = list(
    "Low Status Jobs"  = fjob_low_l2,
    "High Status Jobs" = fjob_high_l2
  )
)

modelsummary(
  fjob_panels_l,
  shape     = "cbind",
  statistic = "std.error",
  coef_map  = c("Conventional" = "Conventional", "Robust" = "Robust"),
  gof_omit  = "^R2 Within|AIC|BIC",
  stars     = TRUE,
  title     = "Split by Father's Employment Status: Liberal Arts Track (Non-parametric Models)",
  output    = "markdown"
)
```

## Mother's employment status

### Distribution of mother's employment status

```{r}
datasummary_crosstab(
  track ~ m_job,
  data = wdat_rd %>% dplyr::mutate(m_job = forcats::fct_na_value_to_level(m_job, level = "Missing")),
  title = "Distribution of Mother's Employment Status",
  output = "markdown"
)

datasummary_crosstab(
  track ~ m_job_l2,
  data = wdat_rd %>% dplyr::mutate(m_job_l2 = forcats::fct_na_value_to_level(m_job_l2, level = "Missing")),
  title = "Distribution of Mother's Employment Status (2 Levels)",
  output = "markdown"
)
```

### Science track

```{r}
# Non-parametric models with `rdrobust`
# Including cohort covariates

# CEE
mjob_low_s1 <- rdrobust(
  y = wdat_rd$cee_ztot_trim,
  x = wdat_rd$hsee_ctot,
  covs = cov_cohort,
  c = 0,
  subset = (wdat_rd$track == "Science Track" & wdat_rd$m_job_l2 == "Low Status Jobs") &
           complete.cases(wdat_rd$cee_ztot_trim, wdat_rd$hsee_ctot, cov_cohort)
)

mjob_high_s1 <- rdrobust(
  y = wdat_rd$cee_ztot_trim,
  x = wdat_rd$hsee_ctot,
  covs = cov_cohort,
  c = 0,
  subset = (wdat_rd$track == "Science Track" & wdat_rd$m_job_l2 == "High Status Jobs") &
           complete.cases(wdat_rd$cee_ztot_trim, wdat_rd$hsee_ctot, cov_cohort)
)

# Average High School Performance
mjob_low_s2 <- rdrobust(
  y = wdat_rd$avg_hs,
  x = wdat_rd$hsee_ctot,
  covs = cov_cohort,
  c = 0,
  subset = (wdat_rd$track == "Science Track" & wdat_rd$m_job_l2 == "Low Status Jobs") &
           complete.cases(wdat_rd$avg_hs, wdat_rd$hsee_ctot, cov_cohort)
)

mjob_high_s2 <- rdrobust(
  y = wdat_rd$avg_hs,
  x = wdat_rd$hsee_ctot,
  covs = cov_cohort,
  c = 0,
  subset = (wdat_rd$track == "Science Track" & wdat_rd$m_job_l2 == "High Status Jobs") &
           complete.cases(wdat_rd$avg_hs, wdat_rd$hsee_ctot, cov_cohort)
)

mjob_panels_s <- list(
  "CEE Total Score" = list(
    "Low Status Jobs"  = mjob_low_s1,
    "High Status Jobs" = mjob_high_s1
  ),
  "Average High School Performance" = list(
    "Low Status Jobs"  = mjob_low_s2,
    "High Status Jobs" = mjob_high_s2
  )
)

modelsummary(
  mjob_panels_s,
  shape     = "cbind",
  statistic = "std.error",
  coef_map  = c("Conventional" = "Conventional", "Robust" = "Robust"),
  gof_omit  = "^R2 Within|AIC|BIC",
  stars     = TRUE,
  title     = "Split by Mother's Employment Status: Science Track (Non-parametric Models)",
  output    = "markdown"
)
```

### Liberal arts track

```{r}
# Non-parametric models with `rdrobust`
# Including cohort covariates

# CEE
mjob_low_l1 <- rdrobust(
  y = wdat_rd$cee_ztot_trim,
  x = wdat_rd$hsee_ctot,
  covs = cov_cohort,
  c = 0,
  subset = (wdat_rd$track == "Liberal Arts Track" & wdat_rd$m_job_l2 == "Low Status Jobs") &
           complete.cases(wdat_rd$cee_ztot_trim, wdat_rd$hsee_ctot, cov_cohort)
)

mjob_high_l1 <- rdrobust(
  y = wdat_rd$cee_ztot_trim,
  x = wdat_rd$hsee_ctot,
  covs = cov_cohort,
  c = 0,
  subset = (wdat_rd$track == "Liberal Arts Track" & wdat_rd$m_job_l2 == "High Status Jobs") &
           complete.cases(wdat_rd$cee_ztot_trim, wdat_rd$hsee_ctot, cov_cohort)
)

# Average High School Performance
mjob_low_l2 <- rdrobust(
  y = wdat_rd$avg_hs,
  x = wdat_rd$hsee_ctot,
  covs = cov_cohort,
  c = 0,
  subset = (wdat_rd$track == "Liberal Arts Track" & wdat_rd$m_job_l2 == "Low Status Jobs") &
           complete.cases(wdat_rd$avg_hs, wdat_rd$hsee_ctot, cov_cohort)
)

mjob_high_l2 <- rdrobust(
  y = wdat_rd$avg_hs,
  x = wdat_rd$hsee_ctot,
  covs = cov_cohort,
  c = 0,
  subset = (wdat_rd$track == "Liberal Arts Track" & wdat_rd$m_job_l2 == "High Status Jobs") &
           complete.cases(wdat_rd$avg_hs, wdat_rd$hsee_ctot, cov_cohort)
)

mjob_panels_l <- list(
  "CEE Total Score" = list(
    "Low Status Jobs"  = mjob_low_l1,
    "High Status Jobs" = mjob_high_l1
  ),
  "Average High School Performance" = list(
    "Low Status Jobs"  = mjob_low_l2,
    "High Status Jobs" = mjob_high_l2
  )
)

modelsummary(
  mjob_panels_l,
  shape     = "cbind",
  statistic = "std.error",
  coef_map  = c("Conventional" = "Conventional", "Robust" = "Robust"),
  gof_omit  = "^R2 Within|AIC|BIC",
  stars     = TRUE,
  title     = "Split by Mother's Employment Status: Liberal Arts Track (Non-parametric Models)",
  output    = "markdown"
)
```

## Combined parental employment status

### Distribution of combined parental employment status

```{r}
datasummary_crosstab(
  track ~ par_job,
  data = wdat_rd %>%
    dplyr::mutate(
      par_job = forcats::fct_na_value_to_level(par_job, level = "Missing")
    ),
  title = "Distribution of Combined Parental Employment Status",
  output = "markdown"
)
```

### Science track

```{r}
# Non-parametric models with `rdrobust`
# Including cohort covariates

# CEE
pjob_neither_s1 <- rdrobust(
  y = wdat_rd$cee_ztot_trim,
  x = wdat_rd$hsee_ctot,
  covs = cov_cohort,
  c = 0,
  subset = (wdat_rd$track == "Science Track" &
            wdat_rd$par_job == "Neither Parent in High Status Jobs") &
           complete.cases(wdat_rd$cee_ztot_trim, wdat_rd$hsee_ctot, cov_cohort)
)

pjob_one_s1 <- rdrobust(
  y = wdat_rd$cee_ztot_trim,
  x = wdat_rd$hsee_ctot,
  covs = cov_cohort,
  c = 0,
  subset = (wdat_rd$track == "Science Track" &
            wdat_rd$par_job == "One Parent in High Status Job") &
           complete.cases(wdat_rd$cee_ztot_trim, wdat_rd$hsee_ctot, cov_cohort)
)

pjob_both_s1 <- rdrobust(
  y = wdat_rd$cee_ztot_trim,
  x = wdat_rd$hsee_ctot,
  covs = cov_cohort,
  c = 0,
  subset = (wdat_rd$track == "Science Track" &
            wdat_rd$par_job == "Both Parents in High Status Jobs") &
           complete.cases(wdat_rd$cee_ztot_trim, wdat_rd$hsee_ctot, cov_cohort)
)

# Average High School Performance
pjob_neither_s2 <- rdrobust(
  y = wdat_rd$avg_hs,
  x = wdat_rd$hsee_ctot,
  covs = cov_cohort,
  c = 0,
  subset = (wdat_rd$track == "Science Track" &
            wdat_rd$par_job == "Neither Parent in High Status Jobs") &
           complete.cases(wdat_rd$avg_hs, wdat_rd$hsee_ctot, cov_cohort)
)

pjob_one_s2 <- rdrobust(
  y = wdat_rd$avg_hs,
  x = wdat_rd$hsee_ctot,
  covs = cov_cohort,
  c = 0,
  subset = (wdat_rd$track == "Science Track" &
            wdat_rd$par_job == "One Parent in High Status Job") &
           complete.cases(wdat_rd$avg_hs, wdat_rd$hsee_ctot, cov_cohort)
)

pjob_both_s2 <- rdrobust(
  y = wdat_rd$avg_hs,
  x = wdat_rd$hsee_ctot,
  covs = cov_cohort,
  c = 0,
  subset = (wdat_rd$track == "Science Track" &
            wdat_rd$par_job == "Both Parents in High Status Jobs") &
           complete.cases(wdat_rd$avg_hs, wdat_rd$hsee_ctot, cov_cohort)
)

pjob_panels_s <- list(
  "CEE Total Score" = list(
    "Neither High Status" = pjob_neither_s1,
    "One High Status"     = pjob_one_s1,
    "Both High Status"    = pjob_both_s1
  ),
  "Average High School Performance" = list(
    "Neither High Status" = pjob_neither_s2,
    "One High Status"     = pjob_one_s2,
    "Both High Status"    = pjob_both_s2
  )
)

modelsummary(
  pjob_panels_s,
  shape     = "cbind",
  statistic = "std.error",
  coef_map  = c("Conventional" = "Conventional", "Robust" = "Robust"),
  gof_omit  = "^R2 Within|AIC|BIC",
  stars     = TRUE,
  title     = "Split by Combined Parental Employment Status: Science Track (Non-parametric Models)",
  output    = "markdown"
)
```

### Liberal arts track

```{r}
# Non-parametric models with `rdrobust`
# Including cohort covariates

# CEE
pjob_neither_l1 <- rdrobust(
  y = wdat_rd$cee_ztot_trim,
  x = wdat_rd$hsee_ctot,
  covs = cov_cohort,
  c = 0,
  subset = (wdat_rd$track == "Liberal Arts Track" &
            wdat_rd$par_job == "Neither Parent in High Status Jobs") &
           complete.cases(wdat_rd$cee_ztot_trim, wdat_rd$hsee_ctot, cov_cohort)
)

pjob_one_l1 <- rdrobust(
  y = wdat_rd$cee_ztot_trim,
  x = wdat_rd$hsee_ctot,
  covs = cov_cohort,
  c = 0,
  subset = (wdat_rd$track == "Liberal Arts Track" &
            wdat_rd$par_job == "One Parent in High Status Job") &
           complete.cases(wdat_rd$cee_ztot_trim, wdat_rd$hsee_ctot, cov_cohort)
)

pjob_both_l1 <- rdrobust(
  y = wdat_rd$cee_ztot_trim,
  x = wdat_rd$hsee_ctot,
  covs = cov_cohort,
  c = 0,
  subset = (wdat_rd$track == "Liberal Arts Track" &
            wdat_rd$par_job == "Both Parents in High Status Jobs") &
           complete.cases(wdat_rd$cee_ztot_trim, wdat_rd$hsee_ctot, cov_cohort)
)

# Average High School Performance
pjob_neither_l2 <- rdrobust(
  y = wdat_rd$avg_hs,
  x = wdat_rd$hsee_ctot,
  covs = cov_cohort,
  c = 0,
  subset = (wdat_rd$track == "Liberal Arts Track" &
            wdat_rd$par_job == "Neither Parent in High Status Jobs") &
           complete.cases(wdat_rd$avg_hs, wdat_rd$hsee_ctot, cov_cohort)
)

pjob_one_l2 <- rdrobust(
  y = wdat_rd$avg_hs,
  x = wdat_rd$hsee_ctot,
  covs = cov_cohort,
  c = 0,
  subset = (wdat_rd$track == "Liberal Arts Track" &
            wdat_rd$par_job == "One Parent in High Status Job") &
           complete.cases(wdat_rd$avg_hs, wdat_rd$hsee_ctot, cov_cohort)
)

pjob_both_l2 <- rdrobust(
  y = wdat_rd$avg_hs,
  x = wdat_rd$hsee_ctot,
  covs = cov_cohort,
  c = 0,
  subset = (wdat_rd$track == "Liberal Arts Track" &
            wdat_rd$par_job == "Both Parents in High Status Jobs") &
           complete.cases(wdat_rd$avg_hs, wdat_rd$hsee_ctot, cov_cohort)
)

pjob_panels_l <- list(
  "CEE Total Score" = list(
    "Neither High Status" = pjob_neither_l1,
    "One High Status"     = pjob_one_l1,
    "Both High Status"    = pjob_both_l1
  ),
  "Average High School Performance" = list(
    "Neither High Status" = pjob_neither_l2,
    "One High Status"     = pjob_one_l2,
    "Both High Status"    = pjob_both_l2
  )
)

modelsummary(
  pjob_panels_l,
  shape     = "cbind",
  statistic = "std.error",
  coef_map  = c("Conventional" = "Conventional", "Robust" = "Robust"),
  gof_omit  = "^R2 Within|AIC|BIC",
  stars     = TRUE,
  title     = "Split by Combined Parental Employment Status: Liberal Arts Track (Non-parametric Models)",
  output    = "markdown"
)
```

**Analyses based on parents' education levels and political status are not conducted because data of only a few cohorts are available.**
